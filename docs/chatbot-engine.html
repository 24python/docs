
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <title>智能问答引擎</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>

    <script src="javascripts/google-code-prettify/run_prettify.js?autoload=true" defer></script>

    <style type="text/css">
    pre.prettyprint { padding: 2px 2px 10px 50px!important; border: 0px!important; }
    </style>

  </head>

  <body class="chatbot-engine" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <a href="http://docs.chatopera.com/">
        <img src="images/logo.png" class="logo" alt="Logo" />
      </a>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="按字母检索">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#4dcbb0e2f6" class="toc-h1 toc-link" data-title="智能问答引擎">智能问答引擎</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#e7f6fc6391" class="toc-h2 toc-link" data-title="架构图">架构图</a>
                  </li>
                  <li>
                    <a href="#087db63ab1" class="toc-h2 toc-link" data-title="安装">安装</a>
                  </li>
                  <li>
                    <a href="#58a18e0129" class="toc-h2 toc-link" data-title="管理控制台">管理控制台</a>
                  </li>
                  <li>
                    <a href="#api" class="toc-h2 toc-link" data-title="API一般规范">API一般规范</a>
                  </li>
                  <li>
                    <a href="#5ca0e833da" class="toc-h2 toc-link" data-title="创建聊天机器人">创建聊天机器人</a>
                  </li>
                  <li>
                    <a href="#f85624657b" class="toc-h2 toc-link" data-title="更新聊天机器人">更新聊天机器人</a>
                  </li>
                  <li>
                    <a href="#08a7a114a5" class="toc-h2 toc-link" data-title="获取聊天机器人信息">获取聊天机器人信息</a>
                  </li>
                  <li>
                    <a href="#cacc022d3c" class="toc-h2 toc-link" data-title="获取聊天机器人列表">获取聊天机器人列表</a>
                  </li>
                  <li>
                    <a href="#45d21076c8" class="toc-h2 toc-link" data-title="删除一个聊天机器人">删除一个聊天机器人</a>
                  </li>
                  <li>
                    <a href="#939de01def" class="toc-h2 toc-link" data-title="创建问答对">创建问答对</a>
                  </li>
                  <li>
                    <a href="#45fca68ce1" class="toc-h2 toc-link" data-title="查询问答对详情">查询问答对详情</a>
                  </li>
                  <li>
                    <a href="#639b49f18a" class="toc-h2 toc-link" data-title="更新问答对">更新问答对</a>
                  </li>
                  <li>
                    <a href="#9b415bdd35" class="toc-h2 toc-link" data-title="删除问答对">删除问答对</a>
                  </li>
                  <li>
                    <a href="#9d5bf325bb" class="toc-h2 toc-link" data-title="查询问答对列表">查询问答对列表</a>
                  </li>
                  <li>
                    <a href="#e42a7f28a9" class="toc-h2 toc-link" data-title="创建扩展问">创建扩展问</a>
                  </li>
                  <li>
                    <a href="#d9ddb9e454" class="toc-h2 toc-link" data-title="查询扩展问">查询扩展问</a>
                  </li>
                  <li>
                    <a href="#2f9f72a954" class="toc-h2 toc-link" data-title="更新扩展问">更新扩展问</a>
                  </li>
                  <li>
                    <a href="#614317fecf" class="toc-h2 toc-link" data-title="删除扩展问">删除扩展问</a>
                  </li>
                  <li>
                    <a href="#863fb227d5" class="toc-h2 toc-link" data-title="导出知识库">导出知识库</a>
                  </li>
                  <li>
                    <a href="#a066be06ce" class="toc-h2 toc-link" data-title="创建近义词">创建近义词</a>
                  </li>
                  <li>
                    <a href="#4534416d99" class="toc-h2 toc-link" data-title="获取近义词详情">获取近义词详情</a>
                  </li>
                  <li>
                    <a href="#6362a031c2" class="toc-h2 toc-link" data-title="更新近义词">更新近义词</a>
                  </li>
                  <li>
                    <a href="#dfa2a554f3" class="toc-h2 toc-link" data-title="删除近义词">删除近义词</a>
                  </li>
                  <li>
                    <a href="#e769425243" class="toc-h2 toc-link" data-title="查询近义词列表">查询近义词列表</a>
                  </li>
                  <li>
                    <a href="#888fe8f0fc" class="toc-h2 toc-link" data-title="检索知识库">检索知识库</a>
                  </li>
                  <li>
                    <a href="#faq" class="toc-h2 toc-link" data-title="记录FAQ点击事件">记录FAQ点击事件</a>
                  </li>
                  <li>
                    <a href="#40fab99bff" class="toc-h2 toc-link" data-title="意图识别服务">意图识别服务</a>
                  </li>
                  <li>
                    <a href="#14fe6f8e8e" class="toc-h2 toc-link" data-title="获得多轮对话列表">获得多轮对话列表</a>
                  </li>
                  <li>
                    <a href="#67e59f9794" class="toc-h2 toc-link" data-title="获得多轮对话详情">获得多轮对话详情</a>
                  </li>
                  <li>
                    <a href="#8dc3a12e6a" class="toc-h2 toc-link" data-title="启用多轮对话">启用多轮对话</a>
                  </li>
                  <li>
                    <a href="#5dc9232d11" class="toc-h2 toc-link" data-title="禁用多轮对话">禁用多轮对话</a>
                  </li>
                  <li>
                    <a href="#3a19a0893c" class="toc-h2 toc-link" data-title="获取环境变量">获取环境变量</a>
                  </li>
                  <li>
                    <a href="#513fa606f2" class="toc-h2 toc-link" data-title="更新环境变量">更新环境变量</a>
                  </li>
                  <li>
                    <a href="#e67bec8043" class="toc-h2 toc-link" data-title="检索多轮对话">检索多轮对话</a>
                  </li>
                  <li>
                    <a href="#abb45a3988" class="toc-h2 toc-link" data-title="导入对话应用">导入对话应用</a>
                  </li>
                  <li>
                    <a href="#f1e15ab5ce" class="toc-h2 toc-link" data-title="获取用户列表">获取用户列表</a>
                  </li>
                  <li>
                    <a href="#dd6b194d03" class="toc-h2 toc-link" data-title="屏蔽指定用户">屏蔽指定用户</a>
                  </li>
                  <li>
                    <a href="#bb401c2d05" class="toc-h2 toc-link" data-title="检查用户是否被屏蔽">检查用户是否被屏蔽</a>
                  </li>
                  <li>
                    <a href="#26ca07432b" class="toc-h2 toc-link" data-title="取消屏蔽用户">取消屏蔽用户</a>
                  </li>
                  <li>
                    <a href="#6746784c6a" class="toc-h2 toc-link" data-title="获取用户聊天历史">获取用户聊天历史</a>
                  </li>
                  <li>
                    <a href="#def9e81899" class="toc-h2 toc-link" data-title="获取应用健康状态">获取应用健康状态</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href="index.html">首页</a></li>
            <li><a href="chatbot-platform.html">开发者平台</a></li>
            <li><a href="conversation-designer.html">多轮对话设计器</a></li>
            <li><a href="omni-channel-customer-support-system.html">春松客服</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='4dcbb0e2f6'>智能问答引擎</h1>
<p>智能问答引擎是问答服务的运行环境，包括可执行从<a href="https://www.chatopera.com/product/conversation-designer">多轮对话设计器</a>导出的对话应用、基于常见问题集的知识库、意图识别和服务统计监控等模块。</p>
<h2 id='e7f6fc6391'>架构图</h2>
<p>从部署拓扑结构上看，智能问答引擎的架构如下图所示：</p>

<table class="image">
<caption align="bottom">智能问答引擎架构</caption>
<tr><td><img width="800" src="images/products/chatopera_superbrain_architecture.png" alt="智能问答引擎架构"/></td></tr>
</table>

<ul>
<li><p>superbrain：智能问答引擎核心服务节点，提供对外操作的Rest APIs，比如知识库管理、多轮对话管理和监控统计等。</p></li>
<li><p>superbrain admin：智能问答引擎管理控制台，提供Web管理页面，方便企业IT人员或业务人员管理智能问答引擎。</p></li>
<li><p>siamese：底层服务，知识库搜索时，文档和查询条件之间的相关度计算模块。</p></li>
<li><p>Elasticsearch：底层服务，存储知识库数据的服务，在检索时，召回数据。</p></li>
<li><p>intent：底层服务，提供意图识别能力。</p></li>
<li><p>redis：底层服务，缓存数据和做定时任务。</p></li>
<li><p>MongoDB：底层服务，superbrain数据的持久化数据库。</p></li>
</ul>

<p>在企业使用过程中，只需要访问superbrain的REST APIs和superbrain admin的Web页面，底层服务的接口并不需要直接访问。同时，上面的七个服务，都是以<a href="https://www.docker.com/">docker镜像</a>的形式分发，以docker容器的形式运行。</p>
<h2 id='087db63ab1'>安装</h2><h3 id='982f45554b'>获取服务镜像</h3>
<p>当前，Chatopera智能问答引擎只面向企业做私有部署，有合作意向的企业联系下面邮箱，进行洽谈：</p>

<p><a href="mailto:info@chatopera.com?Subject=[智能问答引擎]申请试用" target="_top">联系方式：info@chatopera.com</a></p>

<p>洽谈内容包括：</p>

<ul>
<li><p>概念验证</p></li>
<li><p>试用申请</p></li>
<li><p>其他商业合作</p></li>
</ul>

<p>当您获得智能问答引擎的镜像后，可以看到下面的文件：</p>

<p><code>chatopera.superadmin.docker.v1.tgz</code></p>

<p><code>chatopera.superbrain.docker.v1.tgz</code></p>

<p><code>chatopera.siamese.docker.v1.tgz</code></p>

<p><code>chatopera.mongodb.docker.v1.tgz</code></p>

<p><code>chatopera.redis.docker.v1.tgz</code></p>

<p><code>chatopera.elasticsearch.docker.v1.tgz</code></p>
<h3 id='9cfb400ae4'>依赖环境</h3>
<p>智能问答引擎是使用docker镜像进行分发的，所以，只要是docker v12+ 版本支持的操作系统都可以运行智能问答引擎服务，对于更详细的操作系统的兼容列表，请参考<a href="https://www.docker.com/community-edition">Docker Community Edition (CE)</a>。</p>

<p>硬件方面，Chatopera推荐使用4Core CPU(Intel E5 or better)， 16GB Memory，128GB Disk运行服务。</p>

<p>智能问答引擎的docker镜像可以安装在docker服务中，或<a href="https://docs.docker.com/registry/">docker registry</a>中。然后通过容器管理框架，比如<a href="https://kubernetes.io/">kubernetes</a>、<a href="http://mesos.apache.org/">Apache Mesos</a>或<a href="https://docs.docker.com/compose/">docker compose</a>。</p>

<p>在本文档中，介绍使用docker compose的方式部署和管理服务，docker compose是轻量级的docker服务编排方案。</p>

<ul>
<li>docker 版本</li>
</ul>

<p><code>Docker version 18.03.1-ce, build 9ee9f40</code></p>

<p><a href="https://docs.docker.com/install/">安装文档</a>，注意：docker为开源码程序，本文档使用<em>社区版本（Docker CE）</em>。</p>

<ul>
<li>docker-compose</li>
</ul>

<p><code>docker-compose version 1.21.1, build 5a3f1a3</code></p>

<p><a href="https://docs.docker.com/compose/install/">安装文档</a>。</p>
<h3 id='ae330243d6'>安装镜像</h3>
<p>假设docker已经被安装好，并且其进程已经启动，在命令行终端，执行下面命令：</p>

<p><code>docker load &lt; chatopera.superadmin.docker.v1.tgz</code><br>
<code>docker load &lt; chatopera.superbrain.docker.v1.tgz</code><br>
<code>docker load &lt; chatopera.siamese.docker.v1.tgz</code><br>
<code>docker load &lt; chatopera.mongodb.docker.v1.tgz</code><br>
<code>docker load &lt; chatopera.redis.docker.v1.tgz</code><br>
<code>docker load &lt; chatopera.elasticsearch.docker.v1.tgz</code><br></p>

<p>上述命令执行后，查看各个镜像已经安装成功，使用命令：</p>

<p><code>docker images</code></p>
<h3 id='9fd28e58fb'>描述服务</h3>
<p>在命令行终端，进入一个文件路径，智能问答引擎的服务的数据文件将保存在这个路径下，假设该路径为 <code>/app/chatbot</code>。</p>

<ul>
<li>创建服务描述文件 docker-compose.yml</li>
</ul>

<blockquote>
<p>docker-compose.yml：编排服务的描述文件</p>
</blockquote>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>
<span class="na">services</span><span class="pi">:</span>

  <span class="na">superadmin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">registry.chatopera.com/ada/superadmin:develop"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">environment</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">SUPERBRAIN_API_URL=http://superbrain:8003/api/v1</span>

  <span class="na">superbrain</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">registry.chatopera.com/pintuan/superbrain:release"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">environment</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">PORT_NUMBER=8003</span>
     <span class="pi">-</span> <span class="s">SECRET_HASH=demo</span>
     <span class="pi">-</span> <span class="s">MONGO_DB_URI=mongodb://mongodb/superbrain-dev</span>
     <span class="pi">-</span> <span class="s">REDIS_HOST=redis</span>
     <span class="pi">-</span> <span class="s">REDIS_PORT=6379</span>
     <span class="pi">-</span> <span class="s">ELASTICSEARCH_HOST=http://elasticsearch:9200</span>
     <span class="c1"># - ELASTICSEARCH_AUTH=</span>
     <span class="pi">-</span> <span class="s">ELASTICSEARCH_API_VERSION=5.2</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">8003:8003"</span>
    <span class="na">volumes</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">$PWD/superbrain/logs:/app/logs</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">node</span><span class="nv"> </span><span class="s">app.js"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">redis</span>
     <span class="pi">-</span> <span class="s">mongodb</span>
     <span class="pi">-</span> <span class="s">elasticsearch</span>
     <span class="pi">-</span> <span class="s">siamese</span>

  <span class="na">siamese</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">registry.chatopera.com/pintuan/siamese:release"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">8012:8012"</span>
    <span class="na">volumes</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">$PWD/siamese/logs:/logs</span>
    <span class="na">environment</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">TXT_LOG_LVL=DEBUG</span>
     <span class="pi">-</span> <span class="s">SIAMESE_PORT=8012</span>
     <span class="pi">-</span> <span class="s">SIAMESE_THREADS=24</span>
     <span class="pi">-</span> <span class="s">SIAMESE_W2V_MODEL_EN=/word2vec/google-news-slim/GoogleNews-vectors-negative300-SLIM.bin.gz</span>

  <span class="na">mongodb</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tutum/mongodb:3.2"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">volumes</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">$PWD/mongodb/data:/data/db</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">27017:27017"</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">27018:27018"</span>
    <span class="na">environment</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">AUTH=no</span>

  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:latest</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">redis-server --appendonly yes</span>
    <span class="na">volumes</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">$PWD/redis/data:/data</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">6379:6379"</span>

  <span class="na">elasticsearch</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">elasticsearch:5.2.0"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">environment</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">bootstrap.memory_lock=true</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">ES_JAVA_OPTS=-Xms512m</span><span class="nv"> </span><span class="s">-Xmx512m"</span>
    <span class="na">volumes</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">$PWD/elasticsearch/data:/usr/share/elasticsearch/data</span>
     <span class="pi">-</span> <span class="s">$PWD/elasticsearch/plugins:/usr/share/elasticsearch/plugins</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">9200:9200"</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">9300:9300"</span>
    <span class="na">ulimits</span><span class="pi">:</span>
      <span class="na">memlock</span><span class="pi">:</span>
        <span class="na">soft</span><span class="pi">:</span> <span class="s">-1</span>
        <span class="na">hard</span><span class="pi">:</span> <span class="s">-1</span>
</code></pre>
<p>该描述文件采用的格式是YML，该描述文件声明了多个容器服务和它的配置，比如镜像、环境变量、映射的磁盘、日志管理等。<strong>拷贝右侧的代码</strong>为<code>/app/chatbot/docker-compose.yml</code>。</p>

<p>关于服务编排格式更多<a href="https://docs.docker.com/compose/compose-file/compose-file-v2/">说明</a>。</p>
<h3 id='0af030294c'>创建磁盘路径</h3>
<p>Docker容器是一种管理计算资源的方式，它让开发运营软件的构建、分发和运行做到了标准化。对于在容器运行过程中，不慎被删除或崩溃，有可能造成数据丢失。一个解决方案是将Docker容器中应用产生的数据映射到宿主机器的磁盘上。</p>

<p>在命令行终端中， 到<code>/app/chatbot</code>下，执行下面的命令：</p>

<p><code>mkdir -p mongodb/data # 存储 mongodb 数据</code><br>
<code>mkdir -p elasticsearch/data # 存储 elasticsearch 数据</code><br>
<code>mkdir -p elasticsearch/plugins # elasticsearch 插件程序</code><br>
<code>mkdir -p redis/data # 存储 redis 数据</code><br>
<code>mkdir -p superbrain/logs # 存储 superbrain 日志</code><br></p>
<h3 id='f5f2a0dd6f'>启动服务</h3>
<p>完成磁盘路径的创建后，就可以启动服务了。</p>

<p>在命令行终端中， 到<code>/app/chatbot</code>下，执行下面的命令：</p>

<p><code>docker-compose up -d</code></p>

<p>这时，命令会立即退出，因为该命令告诉<code>docker-compose</code>在后台执行启动工作，服务启动需要1-2分钟，这取决于运行服务的硬件资源。</p>

<p>在命令行终端中， 到<code>/app/chatbot</code>下，执行下面的命令查看服务日志：</p>

<p><code>docker-compose logs -f</code></p>

<p>在服务启动的过程中，也可以看到相应日志。</p>

<p>关于<code>docker-compose up</code>的更多使用介绍，请查看<a href="https://docs.docker.com/compose/reference/up/">文档</a>。</p>

<p>在命令行终端中， 到<code>/app/chatbot</code>下，执行下面的命令查看服务启动状态：</p>

<p><code>docker-compose ps</code></p>

<p>在输出中，为多列描述的各服务的信息，其中<code>State</code>列为其中状态，在没有异常发生时，各服务的<code>State</code>均为<strong>Up</strong>，输出结果类似下面：</p>

<p><code>chatoperaio_elasticsearch_1        /docker-entrypoint.sh elas ...   Up      0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp</code><br>
<code>chatoperaio_intent_1               npm start                        Up      0.0.0.0:8027-&gt;8027/tcp</code><br>
<code>chatoperaio_mongodb_1              /run.sh                          Up      0.0.0.0:27017-&gt;27017/tcp, 0.0.0.0:27018-&gt;27018/tcp, 28017/tcp</code><br>
<code>chatoperaio_redis_1                docker-entrypoint.sh redis ...   Up      0.0.0.0:6379-&gt;6379/tcp</code><br>
<code>chatoperaio_siamese_1              /root/venv-py2/bin/python2 ...   Up      0.0.0.0:8012-&gt;8012/tcp</code><br>
<code>chatoperaio_superadmin_1           /bin/sh -c npm start             Up      3000/tcp</code><br>
<code>chatoperaio_superbrain_1           node app.js                      Up      0.0.0.0:8003-&gt;8003/tcp</code><br></p>

<p>以上代表服务正常启动了，这时可以通过访问<strong>智能问答引擎控制台</strong>来管理聊天机器人。</p>

<p><code>http://服务器IP地址:8032</code></p>
<h2 id='58a18e0129'>管理控制台</h2>
<p>智能问答引擎管理控制台是为方便企业IT人员或业务人员管理智能问答引擎而设计的，在服务被正常启动后，管理控制台的URL地址是：</p>

<p><code>http://{{IP}}:8032</code></p>

<p><strong>注意</strong>: {{IP}}是docker容器运行的宿主机器IP地址。</p>

<p>使用浏览器打开该地址，即可使用管理控制台，主要功能包括：</p>

<ul>
<li>聊天机器人增删改差</li>
<li>聊天机器人监控</li>
<li>聊天机器人多轮对话管理</li>
<li>聊天机器人知识库管理</li>
</ul>
<h3 id='479eb4fe58'>聊天机器人管理</h3>
<p>进入控制台，可以看到所有聊天机器人并管理。</p>

<table class="image">
<caption align="bottom">控制台</caption>
<tr><td><img width="800" src="images/products/superadmin/42856529-304dde8e-8a78-11e8-87f1-964291c2852f.png" alt="控制台"/></td></tr>
</table>

<p>点击“新建”，创建一个聊天机器人。</p>

<table class="image">
<caption align="bottom">新建机器人</caption>
<tr><td><img width="800" src="images/products/superadmin/42859842-01c1aabe-8a87-11e8-9d49-b24a101a8131.png" alt="新建机器人"/></td></tr>
</table>

<p>新建完成后会直接进入机器人<strong>详情页面</strong>，默认显示设置标签，更新机器人名字，描述等信息。</p>

<table class="image">
<caption align="bottom">管理详情</caption>
<tr><td><img width="800" src="images/products/superadmin/42860041-fa4fe498-8a87-11e8-95f4-a9f845492bd7.png" alt="管理详情"/></td></tr>
</table>
<h3 id='bbf5b74e55'>聊天机器人监控</h3>
<p>通过<strong>仪表盘</strong>可以查看机器人的使用情况。</p>

<table class="image">
<caption align="bottom">仪表盘</caption>
<tr><td><img width="800" src="images/products/superadmin/42860378-baac14aa-8a88-11e8-957e-3d3dcc1b3484.png" alt="仪表盘"/></td></tr>
</table>
<h3 id='e8aacea612'>多轮对话管理</h3>
<p>使用<a href="https://www.chatopera.com/product/conversation-designer" target="_blank">多轮对话设计器</a> 设计对话应用并导出的程序包，程序包后缀名是.c66。导入可以看到对话列表，也可以设置各个对话的状态。</p>

<table class="image">
<caption align="bottom">多轮对话</caption>
<tr><td><img width="800" src="images/products/superadmin/42861165-820b1dc2-8a8c-11e8-80f1-d2b329afc800.png" alt="多轮对话"/></td></tr>
</table>

<p>多轮对话的<strong>函数</strong>和<strong>环境</strong>变量可以在这里查看和设置。</p>

<table class="image">
<caption align="bottom">环境变量</caption>
<tr><td><img width="800" src="images/products/superadmin/42860742-86b64146-8a8a-11e8-88ed-b56b93f396be.png" alt="环境变量"/></td></tr>
</table>

<p>同时，也可以查看多轮对话的脚本。</p>

<table class="image">
<caption align="bottom">查看脚本</caption>
<tr><td><img width="800" src="images/products/superadmin/42863336-4fdb49c2-8a95-11e8-9608-b3757d68ec49.png" alt="查看脚本"/></td></tr>
</table>

<p>点击“逻辑”，查看聊天机器人的思维逻辑导图。</p>

<table class="image">
<caption align="bottom">逻辑</caption>
<tr><td><img width="800" src="images/products/superadmin/42862020-5081e066-8a90-11e8-815b-1dbed47ce099.png" alt="逻辑"/></td></tr>
</table>
<h3 id='053fc4ecbf'>知识库管理</h3>
<p>知识库包括问答对和近义词，问答对支持批量导入，导入文件格式必须是<strong>UTF-8编码的CSV</strong>文件。</p>

<p>该CSV文件的每一行内容格式为：
<code>是否启用，标准问,答案,扩展问1,扩展问2,扩展问3</code></p>

<blockquote>
<p>CSV文件示例</p>
</blockquote>
<pre class="highlight plaintext"><code>true,钱款数据在哪查,微信商户支付平台里
false,怎么计算中奖呢,无法计算,中奖计算方法
true,没有二维码,刷新当前页,看不到二维码
</code></pre>
<table class="image">
<caption align="bottom">常见问题</caption>
<tr><td><img width="800" src="images/products/superadmin/42862106-ac4fc17e-8a90-11e8-902c-4e58ad24f20f.png" alt="常见问题"/></td></tr>
</table>

<p>在问答对管理页面，也支持导出问答对为CSV文件，检索问答对等操作。</p>

<p>编辑一个问答对的标准问、扩展问、回复和状态。</p>

<table class="image">
<caption align="bottom">问题编辑</caption>
<tr><td><img width="800" src="images/products/superadmin/42863264-17709aa6-8a95-11e8-9e4b-d22df4ab7872.png" alt="问题编辑"/></td></tr>
</table>

<p>为提高准确性，支持自定义近义词。</p>

<table class="image">
<caption align="bottom">近义词</caption>
<tr><td><img width="800" src="images/products/superadmin/42863223-ea1f9b06-8a94-11e8-9e1d-22a55f281749.png" alt="近义词"/></td></tr>
</table>
<h2 id='api'>API一般规范</h2>
<p>智能问答引擎与其他服务集成的方式是暴露出来的Rest API接口，接口可以分为以下几类：</p>

<table><thead>
<tr>
<th>资源</th>
<th>描述</th>
<th>路径前缀</th>
</tr>
</thead><tbody>
<tr>
<td><strong>聊天机器人</strong></td>
<td>对象的增删改查</td>
<td><code>/api/v1/chatbot</code></td>
</tr>
<tr>
<td><strong>多轮对话</strong></td>
<td>查询，导入和状态管理</td>
<td><code>/api/v1/chatbot/:ChatbotID/conversation</code></td>
</tr>
<tr>
<td><strong>多轮对话</strong></td>
<td>问答的使用情况统计数据</td>
<td><code>/api/v1/chatbot/:chatbotID/conversation/query/counts</code></td>
</tr>
<tr>
<td><strong>知识库FAQ问答对</strong></td>
<td>增删改查和状态管理</td>
<td><code>/api/v1/chatbot/:chatbotID/faq/database</code></td>
</tr>
<tr>
<td><strong>知识库近义词</strong></td>
<td>增删改查</td>
<td><code>/api/v1/chatbot/:ChatbotID/faq/synonyms</code></td>
</tr>
<tr>
<td><strong>知识库</strong></td>
<td>问答的使用情况统计数据</td>
<td><code>/api/v1/chatbot/:chatbotID/faq/query/counts</code></td>
</tr>
<tr>
<td><strong>意图识别</strong></td>
<td>分析接口</td>
<td><code>/api/v1/chatbot/:ChatbotID/intent/parse</code></td>
</tr>
<tr>
<td><strong>历史管理</strong></td>
<td>查询对话历史，用户列表</td>
<td><code>/api/v1/chatbot/:ChatbotID/users</code></td>
</tr>
<tr>
<td><strong>应用健康</strong></td>
<td>状态查询接口</td>
<td><code>/ping</code></td>
</tr>
</tbody></table>
<h3 id='1e30c2b374'>基本规范</h3>
<p>在Rest API接口中，请求包括协议(http/https)，IP地址(Host)，HTTP头字段(Headers)，HTTP报文主体(Body <em>可选</em>)。</p>

<ul>
<li>请求(Request)</li>
</ul>

<p>在智能问答引擎服务启动后，通过 <em>http</em> 协议处理请求，如无特殊说明，每个接口都有如下设置：</p>

<p>Host: <code>{{IP}}</code></p>

<p>Headers: <code>Content-Type application/json</code></p>

<p><strong>注意</strong>：
1. <code>{{变量}}</code>代表变量；
2. <code>{{IP}}</code>代表服务运行的宿主机器的IP地址。</p>

<ul>
<li>响应(Response)</li>
</ul>

<p>如无特殊说明，返回值都是<code>JSON</code>数据格式，在<strong>正常返回</strong>下，格式符合如下形式：</p>

<pre class="prettyprint">
{
  "rc": 0,
  "data": ...
}    
</pre>

<p>其中，<code>rc</code>代表请求是否被满足，<code>0</code>代表满足；<code>rc</code>非<code>0</code>时，代表有异常，不同的异常类型使用不同的数字，在每个API中介绍。</p>

<p>异常返回的一般形式：</p>

<pre class="prettyprint">
{
  "rc": 非0的正整数,
  "error": ...,
  "msg": ...
}    
</pre>
<h2 id='5ca0e833da'>创建聊天机器人</h2><h3 id='post-api-v1-chatbot-chatbotid'>POST /api/v1/chatbot/:ChatbotID</h3>
<blockquote>
<p>cURL：创建聊天机器人</p>
</blockquote>
<pre class="highlight shell"><code>curl --request POST <span class="se">\</span>
  --url <span class="s1">'http://{{IP}}:8003/api/v1/chatbot/{{chatbotID}}'</span> <span class="se">\</span>
  --header <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  --data <span class="s1">'{
  "name": "小叮当",
  "primaryLanguage": "zh_CN"
}'</span>
</code></pre>
<p>创建聊天机器人</p>
<h4 id='body'>BODY</h4>
<pre class="prettyprint">
{
  "name": "小叮当",
  "primaryLanguage": "zh_CN"
}    
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>chatbotID</td>
<td>是</td>
<td>string</td>
<td>机器人的唯一ID，是以字母开始的由[a-zA-Z0-9_]组成的字符串。</td>
</tr>
<tr>
<td>name</td>
<td>是</td>
<td>string</td>
<td>机器人的名称。</td>
</tr>
<tr>
<td>primaryLanguage</td>
<td>是</td>
<td>string</td>
<td>机器人的语言，现在支持两个选项：[&quot;zh_CN&quot;, &quot;en_US&quot;]，分别代表中文和英文。</td>
</tr>
<tr>
<td>description</td>
<td>否</td>
<td>string</td>
<td>机器人的描述</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "chatbotID": "{{chatbotID}}",
        "name": "小叮当",
        "fallback": "我不明白您的意思。",
        "description": "智能问答和对话任务",
        "welcome": "你好！我是机器人客服。",
        "primaryLanguage": "zh_CN"
    }
} 
</pre>

<p>返回字段说明：</p>

<p><code>fallback</code>：聊天机器人的兜底回复。</p>

<p><code>description</code>：聊天机器人的描述。</p>

<p><code>welcome</code>：欢迎语。</p>
<h4 id='1e8511e76c'>异常返回</h4>
<pre class="prettyprint">
{
    "rc":2,
    "error":"already exists."
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>：非0正整数代表不同的异常类型，比如，当前<code>rc</code>是2，异常描述为“already exists.”，说明该{{chatbotID}}已经存在了。</p>
<h2 id='f85624657b'>更新聊天机器人</h2><h3 id='put-api-v1-chatbot-chatbotid'>PUT /api/v1/chatbot/:ChatbotID</h3>
<blockquote>
<p>cURL：更新聊天机器人</p>
</blockquote>
<pre class="highlight shell"><code>curl -X PUT <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "fallback": "我不能理解您的意思。",
    "description": "聊天机器人",
    "welcome": "我的特长是聊天。"
}'</span>
</code></pre>
<p>更新聊天机器人</p>
<h4 id='body-2'>BODY</h4>
<pre class="prettyprint">
{
    "fallback": "我不能理解您的意思。",
    "description": "聊天机器人",
    "welcome": "我的特长是聊天。"
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>fallback</td>
<td>否</td>
<td>string</td>
<td>机器人兜底回复，在多轮对话查询没有匹配到回复时使用。</td>
</tr>
<tr>
<td>description</td>
<td>否</td>
<td>string</td>
<td>描述该机器人。</td>
</tr>
<tr>
<td>welcome</td>
<td>否</td>
<td>string</td>
<td>欢迎语，保留字段，暂时未使用。</td>
</tr>
</tbody></table>

<p>对于机器人的<code>chatbotID</code>，<code>name</code>和<code>primaryLanguage</code>都是在创建时设定的，设定后不能变更。</p>
<h4 id='01b2e1fa11-2'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "chatbotID": "{{chatbotID}}",
        "fallback": ...,
        "description": ...,
        "welcome": ...
    }
}
</pre>
<h4 id='1e8511e76c-2'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ...
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='08a7a114a5'>获取聊天机器人信息</h2><h3 id='get-api-v1-chatbot-chatbotid'>GET /api/v1/chatbot/:ChatbotID</h3>
<blockquote>
<p>cURL：获取聊天机器人信息</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>获取聊天机器人信息</p>
<h4 id='body-3'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-3'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "chatbotID": "{{chatbotID}}",
        "name": "小叮当",
        "fallback": "我不明白您的意思。",
        "description": "智能问答和对话任务",
        "welcome": "你好！我是机器人客服。",
        "primaryLanguage": "zh_CN"
    }
}
</pre>
<h4 id='1e8511e76c-3'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": "not exist."
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='cacc022d3c'>获取聊天机器人列表</h2><h3 id='get-api-v1-chatbot'>GET /api/v1/chatbot</h3>
<blockquote>
<p>cURL：获取聊天机器人列表</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  <span class="s1">'http://{{IP}}:8003/api/v1/chatbot?sortby=-created&amp;q={"chatbotID": "department_1"}'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>获取聊天机器人列表</p>
<h4 id='query'>QUERY</h4>
<p>支持在URL中添加query信息来查询机器人和翻页等操作，比如 <code>/api/v1/chatbot?page=1&amp;limit=10&amp;fields=chatbotID name&amp;q={&quot;name&quot;: &quot;test&quot;}</code>，各参数介绍如下：</p>

<table><thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>默认值</th>
<th>示例</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>number</td>
<td>返回本页数据的条数</td>
<td>100</td>
<td>10</td>
</tr>
<tr>
<td>page</td>
<td>number</td>
<td>返回哪一页(可根据total进行判断)</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>fields</td>
<td>string</td>
<td>返回哪些字段</td>
<td>除_id 和 __v之外的所有字段</td>
<td>chatbotID name</td>
</tr>
<tr>
<td>sortby</td>
<td>string</td>
<td>按照哪个字段进行排序</td>
<td>空</td>
<td>-created (按照 created 降序)</td>
</tr>
<tr>
<td>q</td>
<td>string</td>
<td>按照字段查询</td>
<td>空</td>
<td>{&quot;name&quot;: &quot;test&quot;}</td>
</tr>
</tbody></table>
<h4 id='body-4'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-4'>成功返回</h4>
<pre class="prettyprint">
{
    "total": 1,
    "rc": 0,
    "current_page": 1,
    "total_page": 1,
    "data": [
        {
            "name": "小叮当",
            "chatbotID": "{{chatbotID}}",
            "primaryLanguage": "zh_CN",
            "fallback": "我不明白您的意思。",
            "welcome": "你好！我是机器人客服。",
            "description": "智能问答和对话任务"
        },
        ...
    ]
}
</pre>

<p>返回字段说明：</p>

<p><code>total</code>代表聊天机器人数量。</p>

<p><code>current_page</code>代表当前页，<code>total_page</code>代表总页数。</p>

<p><code>data</code>是聊天机器人数据。</p>
<h4 id='1e8511e76c-4'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ...
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='45d21076c8'>删除一个聊天机器人</h2><h3 id='delete-api-v1-chatbot-chatbotid'>DELETE /api/v1/chatbot/:ChatbotID</h3>
<blockquote>
<p>cURL：删除一个聊天机器人</p>
</blockquote>
<pre class="highlight shell"><code>curl -X DELETE <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
</code></pre>
<p>删除一个聊天机器人</p>
<h4 id='body-5'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-5'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "message": "done."
    }
}
</pre>
<h4 id='1e8511e76c-5'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ...
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='939de01def'>创建问答对</h2><h3 id='post-api-v1-chatbot-chatbotid-faq-database'>POST /api/v1/chatbot/:ChatbotID/faq/database</h3>
<blockquote>
<p>cURL：创建问答对</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "post": "怎么开通微信支付?",
    "reply": "登录微信公众号平台，点击左侧微信支付菜单栏，按照开通步骤开通微信支付",
    "enabled": true
}'</span>
</code></pre>
<p>创建问答对</p>
<h4 id='body-6'>BODY</h4>
<pre class="prettyprint">
{
    "post": "怎么开通微信支付?",
    "reply": "登录微信公众号平台，点击左侧微信支付菜单栏，按照开通步骤开通微信支付",
    "enabled": true
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>post</td>
<td>是</td>
<td>string</td>
<td>问答对的问题，也称“标准问”</td>
</tr>
<tr>
<td>reply</td>
<td>是</td>
<td>string</td>
<td>问题对应的回复</td>
</tr>
<tr>
<td>enabled</td>
<td>是</td>
<td>boolean</td>
<td>是否“启用”，启用代表该问答对在检索时被使用；否则不被检索</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-6'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "id": "{{docId}}}"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>docId</code>代表该问答对的唯一标识。</p>
<h4 id='1e8511e76c-6'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": ...
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='45fca68ce1'>查询问答对详情</h2><h3 id='get-api-v1-chatbot-chatbotid-faq-database-docid'>GET /api/v1/chatbot/:ChatbotID/faq/database/:docId</h3>
<blockquote>
<p>cURL：根据文档Id查询问答对详情</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/<span class="o">{{</span>docId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>根据文档Id查询问答对详情</p>
<h4 id='body-7'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-7'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "id": "{{docId}}",
        "post": "怎么开通微信支付?",
        "reply": "登录微信公众号平台，点击左侧微信支付菜单栏，按照开通步骤开通微信支付",
        "enabled": true
    }
}
</pre>
<h4 id='1e8511e76c-7'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": {
        "msg": "Not Found"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='639b49f18a'>更新问答对</h2><h3 id='put-api-v1-chatbot-chatbotid-faq-database-docid'>PUT /api/v1/chatbot/:ChatbotID/faq/database/:docId</h3>
<blockquote>
<p>cURL：根据文档ID更新问答对</p>
</blockquote>
<pre class="highlight shell"><code>curl -X PUT <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/<span class="o">{{</span>docId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "post": "怎么开通微信支付?",
    "reply": "登录微信公众号平台，点击左侧微信支付菜单栏，按照开通步骤开通微信支付",
    "enabled": true
}'</span>
</code></pre>
<p>根据文档ID更新问答对</p>
<h4 id='body-8'>BODY</h4>
<pre class="prettyprint">
{
    "post": "怎么开通微信支付?",
    "reply": "登录微信公众号平台，点击左侧微信支付菜单栏，按照开通步骤开通微信支付",
    "enabled": true
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>post</td>
<td>否</td>
<td>string</td>
<td>问答对的问题，也称“标准问”</td>
</tr>
<tr>
<td>reply</td>
<td>否</td>
<td>string</td>
<td>问题对应的回复</td>
</tr>
<tr>
<td>enabled</td>
<td>否</td>
<td>boolean</td>
<td>是否“启用”，启用代表该问答对在检索时被使用；否则不被检索</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-8'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "id": "{{docId}}"
    }
}
</pre>
<h4 id='1e8511e76c-8'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": {
        "msg": "Not Found"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='9b415bdd35'>删除问答对</h2><h3 id='delete-api-v1-chatbot-chatbotid-faq-database-docid'>DELETE /api/v1/chatbot/:ChatbotID/faq/database/:docId</h3>
<blockquote>
<p>cURL：根据文档ID删除问答对</p>
</blockquote>
<pre class="highlight shell"><code>curl -X DELETE <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/<span class="o">{{</span>docId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>根据文档ID删除问答对</p>
<h4 id='body-9'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-9'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "message": "done"
}
</pre>
<h4 id='1e8511e76c-9'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": {
        "msg": "Not Found"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='9d5bf325bb'>查询问答对列表</h2><h3 id='get-api-v1-chatbot-chatbotid-faq-database'>GET /api/v1/chatbot/:ChatbotID/faq/database</h3>
<blockquote>
<p>cURL：查询问答对列表，可根据字段查询，支持分页</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  <span class="s1">'http://{{IP}}:8003/api/v1/chatbot/{{chatbotID}}/faq/database?limit=30'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>查询问答对列表，可根据字段查询，支持分页</p>
<h4 id='query-2'>QUERY</h4>
<p>在url中，支持使用检索条件，比如 <code>/api/v1/chatbot/{{chatbotID}}/faq/database?page=1&amp;limit=10</code>，各参数介绍如下：</p>

<table><thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>默认值</th>
<th>示例</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>number</td>
<td>返回本页数据的条数</td>
<td>100</td>
<td>10</td>
</tr>
<tr>
<td>page</td>
<td>number</td>
<td>返回哪一页(可根据total进行判断)</td>
<td>1</td>
<td>2</td>
</tr>
</tbody></table>
<h4 id='body-10'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-10'>成功返回</h4>
<pre class="prettyprint">
{
    "total": 354,
    "current_page": 1,
    "total_page": 12,
    "data": [
        {
            "post": "上架商品就不能修改了是吗？",
            "is_original": true,
            "reply": "没有订单产生时可以修改",
            "enabled": true,
            "id": "{{docId}}"
        },
        ...
    ]
}
</pre>
<h4 id='1e8511e76c-10'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": {
        "msg": "[index_not_found_exception] no such index
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='e42a7f28a9'>创建扩展问</h2><h3 id='post-api-v1-chatbot-chatbotid-faq-database-docid-extend'>POST /api/v1/chatbot/:chatbotID/faq/database/:docId/extend</h3>
<blockquote>
<p>cURL：创建扩展问</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/<span class="o">{{</span>docId<span class="o">}}</span>/extend <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "post": "怎样支持微信支付?"
}
'</span>
</code></pre>
<p>创建扩展问，扩展问关联一个问答对，扩展问是标准问的另一种问法。一个问答对可以关联多个扩展问。</p>

<p>扩展问可以使系统更智能，提高检索的准确率。</p>
<h4 id='body-11'>BODY</h4>
<pre class="prettyprint">
{
    "post": "怎样支持微信支付?"
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>post</td>
<td>是</td>
<td>string</td>
<td>与标准问意思一致的另一种问法，也称“扩展问”。</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-11'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "id": "{{extendId}}"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>extendId</code>是该扩展问的唯一标识。</p>
<h4 id='1e8511e76c-11'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ...
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='d9ddb9e454'>查询扩展问</h2><h3 id='get-api-v1-chatbot-chatbotid-faq-database-docid-extend'>GET /api/v1/chatbot/:chatbotID/faq/database/:docId/extend</h3>
<blockquote>
<p>cURL：查询扩展问</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/<span class="o">{{</span>docId<span class="o">}}</span>/extend <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>查询扩展问</p>
<h4 id='body-12'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-12'>成功返回</h4>
<pre class="prettyprint">
{
    "total": 1,
    "current_page": 1,
    "total_page": 1,
    "data": [
        {
            "post": "怎样支持微信支付?",
            "is_original": false,
            "postId": "{{docId}}",
            "enabled": true,
            "id": "{{extendId}}"
        },
        ...
    ],
    "rc": 0
}
</pre>
<h4 id='1e8511e76c-12'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": ...
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='2f9f72a954'>更新扩展问</h2><h3 id='put-api-v1-chatbot-chatbotid-faq-database-docid-extend-extendid'>PUT /api/v1/chatbot/:chatbotID/faq/database/:docId/extend/:extendId</h3>
<blockquote>
<p>cURL：更新扩展问</p>
</blockquote>
<pre class="highlight shell"><code>curl -X PUT <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/<span class="o">{{</span>docId<span class="o">}}</span>/extend/<span class="o">{{</span>extendId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "post": "怎样支持微信支付?"
}
'</span>
</code></pre>
<p>更新扩展问</p>
<h4 id='body-13'>BODY</h4>
<pre class="prettyprint">
{
    "post": "怎样支持微信支付?"
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>post</td>
<td>是</td>
<td>string</td>
<td>与标准问意思一致的另一种问法，也称“扩展问”。</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-13'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "id": "{{extendId}}"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>extendId</code>是该扩展问的唯一标识。</p>
<h4 id='1e8511e76c-13'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": {
        "msg": "Not Found"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='614317fecf'>删除扩展问</h2><h3 id='delete-api-v1-chatbot-chatbotid-faq-database-docid-extend-extendid'>DELETE /api/v1/chatbot/:chatbotID/faq/database/:docId/extend/:extendId</h3>
<blockquote>
<p>cURL：删除扩展问</p>
</blockquote>
<pre class="highlight shell"><code>curl -X DELETE <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/<span class="o">{{</span>docId<span class="o">}}</span>/extend/<span class="o">{{</span>extendId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>删除扩展问</p>
<h4 id='body-14'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-14'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "message": "done"
}
</pre>
<h4 id='1e8511e76c-14'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 3,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='863fb227d5'>导出知识库</h2><h3 id='get-api-v1-chatbot-chatbotid-faq-database-export'>GET /api/v1/chatbot/:ChatbotID/faq/database/export</h3>
<blockquote>
<p>cURL：导出问答对数据</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/database/export <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>导出问答对数据</p>
<h4 id='body-15'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-15'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": [
        [
            true,
            "怎么开通微信支付?",
            "登录微信公众号平台，点击左侧微信支付菜单栏，按照开通步骤开通微信支付",
            "如何支持微信支付"
        ],
        ...
    ]
}
</pre>

<p>返回字段说明：</p>

<p><code>data</code>是问答对的所有数据，每个元素代表一个问答对。
每个元素又是一个数组，按照顺序分别代表：[enabled，标准问，回复，0~多个扩展问]。</p>
<h4 id='1e8511e76c-15'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='a066be06ce'>创建近义词</h2><h3 id='post-api-v1-chatbot-chatbotid-faq-synonyms'>POST /api/v1/chatbot/:ChatbotID/faq/synonyms</h3>
<blockquote>
<p>cURL：创建近义词</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/synonyms <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "text": "番茄",
    "neighbors": ["西红柿", "狼桃"]
}'</span>
</code></pre>
<p>创建近义词，近义词可以进一步提高系统的智能水平。</p>
<h4 id='body-16'>BODY</h4>
<pre class="prettyprint">
{
    "text": "番茄",
    "neighbors": ["西红柿", "狼桃"]
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>text</td>
<td>是</td>
<td>string</td>
<td>词汇</td>
</tr>
<tr>
<td>neighbors</td>
<td>是</td>
<td>[string]</td>
<td>与text意思相近的词汇</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-16'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "text": "番茄",
        "chatbot": "{{chatbotID}}",
        "neighbors": [
            "西红柿",
            "狼桃"
        ],
        "id": "{{synonymsId}}"
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>synonymsId</code>是该近义词组的唯一标识。</p>
<h4 id='1e8511e76c-16'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='4534416d99'>获取近义词详情</h2><h3 id='get-api-v1-chatbot-chatbotid-faq-synonyms-synonymsid'>GET /api/v1/chatbot/:ChatbotID/faq/synonyms/:synonymsId</h3>
<blockquote>
<p>cURL：使用synonymsId获取近义词详情</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/synonyms/<span class="o">{{</span>synonymsId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>使用synonymsId获取近义词详情</p>
<h4 id='body-17'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-17'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "text": "番茄",
        "neighbors": [
            "西红柿",
            "狼桃"
        ]
    }
}
</pre>
<h4 id='1e8511e76c-17'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='6362a031c2'>更新近义词</h2><h3 id='put-api-v1-chatbot-chatbotid-faq-synonyms-synonymsid'>PUT /api/v1/chatbot/:ChatbotID/faq/synonyms/:synonymsId</h3>
<blockquote>
<p>cURL：更新近义词</p>
</blockquote>
<pre class="highlight shell"><code>curl -X PUT <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/synonyms/<span class="o">{{</span>synonymsId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "text": "番茄",
    "neighbors": ["西红柿", "狼桃", "洋柿子"]
}'</span>
</code></pre>
<p>更新近义词</p>
<h4 id='body-18'>BODY</h4>
<pre class="prettyprint">
{
    "text": "番茄",
    "neighbors": ["西红柿", "狼桃", "洋柿子"]
}
</pre>
<h4 id='01b2e1fa11-18'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "text": "番茄",
        "neighbors": [
            "西红柿",
            "狼桃",
            "洋柿子"
        ]
    }
}
</pre>
<h4 id='1e8511e76c-18'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>
<h2 id='dfa2a554f3'>删除近义词</h2><h3 id='delete-api-v1-chatbot-chatbotid-faq-synonyms-synonymsid'>DELETE /api/v1/chatbot/:ChatbotID/faq/synonyms/:synonymsId</h3>
<blockquote>
<p>cURL：删除近义词</p>
</blockquote>
<pre class="highlight shell"><code>curl -X DELETE <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/synonyms/<span class="o">{{</span>synonymsId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>删除近义词</p>
<h4 id='body-19'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-19'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "message": "done"
}
</pre>
<h4 id='1e8511e76c-19'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='e769425243'>查询近义词列表</h2><h3 id='get-api-v1-chatbot-chatbotid-faq-synonyms'>GET /api/v1/chatbot/:ChatbotID/faq/synonyms</h3>
<blockquote>
<p>cURL：查询近义词列表，支持分页和按字段查询</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/synonyms <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>查询近义词列表，支持分页和按字段查询</p>
<h4 id='body-20'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-20'>成功返回</h4>
<pre class="prettyprint">
{
    "total": 1,
    "rc": 0,
    "current_page": 1,
    "total_page": 1,
    "data": [
        {
            "text": "番茄",
            "chatbot": "{{chatbotID}}",
            "neighbors": [
                "西红柿",
                "狼桃",
                "洋柿子"
            ],
            "id": "{{synonymsId}}"
        },
        ...
    ]
}
</pre>
<h4 id='1e8511e76c-20'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='888fe8f0fc'>检索知识库</h2><h3 id='post-api-v1-chatbot-chatbotid-faq-query'>POST /api/v1/chatbot/:ChatbotID/faq/query</h3>
<blockquote>
<p>cURL：根据查询句子查询答案, 返回答案列表，并带有分数</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/query <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "fromUserId": "test",
    "query": "如何开通微信支付"
}'</span>
</code></pre>
<p><code>fromUserId</code> 代表用户的唯一标识，必填项。
<code>query</code> 代表请求的查询，必填项。</p>

<p>根据查询句子查询答案, 返回答案列表，并带有分数。</p>
<h4 id='body-21'>BODY</h4>
<pre class="prettyprint">
{
    "fromUserId": "xxx",
    "query": "如何开通微信支付"
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>fromUserId</td>
<td>是</td>
<td>string</td>
<td>用户的唯一标识</td>
</tr>
<tr>
<td>query</td>
<td>是</td>
<td>string</td>
<td>从知识库中检索的目标</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-21'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": [
        {
            "id": "{{docId}}",
            "score": 0.647,
            "post": "怎么开通微信支付?",
            "reply": "登录微信公众号平台，点击左侧微信支付菜单栏，按照开通步骤开通微信支付"
        }
    ]
}
</pre>

<p>返回字段说明：</p>

<p><code>data</code>是一个数组，包含0～多个问答对，并且按照匹配程度降序，匹配程度就是该问答对的问题和<code>query</code>的相似度。</p>

<p>相似度是属于[0-1]区间的值，越大代表语义越相似。</p>
<h4 id='1e8511e76c-21'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='faq'>记录FAQ点击事件</h2><h3 id='post-api-v1-chatbot-chatbotid-faq-click'>POST /api/v1/chatbot/:ChatbotID/faq/click</h3>
<blockquote>
<p>cURL：记录FAQ点击事件</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/faq/click <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "query": "如何开通微信支付",
    "groundtruth": "如何支持微信支付",
    "negatives": ["如何支持支付", "怎么取消微信支付"]
}'</span>
</code></pre>
<p>记录FAQ点击事件：在客服人员点击建议问时，将访客的问题和客服点击的问题记录下来。</p>

<p>点击事件具有很重要的价值：</p>

<ol>
<li><p>梳理业务，提高商业智能;</p></li>
<li><p>方便统计系统使用情况;</p></li>
<li><p>评估系统准确率;</p></li>
<li><p>优化系统准确率，比如训练更好的机器学习模型。</p></li>
</ol>

<p>所以，该接口应保证尽可能调用。</p>
<h4 id='body-22'>BODY</h4>
<pre class="prettyprint">
{
    "query": "如何开通微信支付",
    "groundtruth": "如何支持微信支付",
    "negatives": ["如何支持支付", "怎么取消微信支付"]
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>query</td>
<td>是</td>
<td>string</td>
<td>原始查询</td>
</tr>
<tr>
<td>groundtruth</td>
<td>是</td>
<td>string</td>
<td>准确答案</td>
</tr>
<tr>
<td>negatives</td>
<td>是</td>
<td>[string]</td>
<td>被展示为建议答案但是没有被选中的候选回复</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-22'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "message": "done"
}
</pre>

<p>返回字段说明：</p>
<h4 id='1e8511e76c-22'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='40fab99bff'>意图识别服务</h2><h3 id='post-api-v1-chatbot-chatbotid-intent-parse'>POST /api/v1/chatbot/:chatbotID/intent/parse</h3>
<blockquote>
<p>cURL：意图识别服务</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/intent/parse <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "query": "can I have my cashback",
        "clientId": "gmis"
}'</span>
</code></pre>
<p>使用机器学习模型，分析意图和实体。</p>
<h4 id='body-23'>BODY</h4>
<pre class="prettyprint">
{
    "query": "我想取钱",
    "clientId": "{{clientId}}"
}
</pre>

<table><thead>
<tr>
<th>字段</th>
<th>必须</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>query</td>
<td>是</td>
<td>string</td>
<td>待被分析意图的句子</td>
</tr>
<tr>
<td>clientId</td>
<td>是</td>
<td>string</td>
<td>客户唯一标识，目前意图识别模型依赖每个客户的数据，和客户的业务关系紧密，每个客户单独制作。</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-23'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "tag": "{{intentId}}",
        "score": 2.515
    }
}
</pre>

<p>返回字段说明：</p>

<p>如果<code>rc</code>为0，但是<code>data</code>中不包含<code>tag</code>和<code>score</code>时，代表程序未能识别出意图。</p>
<h4 id='1e8511e76c-23'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='14fe6f8e8e'>获得多轮对话列表</h2><h3 id='get-api-v1-chatbot-chatbotid-conversation'>GET /api/v1/chatbot/:chatbotID/conversation</h3>
<blockquote>
<p>cURL：获得对话列表</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>获得对话列表</p>
<h4 id='body-24'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-24'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "total": 1,
    "current_page": 1,
    "total_page": 1,
    "data": [
        {
            "chatbotID": "{{chatbotID}}",
            "name": "{{conversationName}}",
            "enabled": true,
            "id": "{{conversationId}}"
        },
        ...
    ]
}
</pre>

<p>返回字段说明：</p>
<h4 id='1e8511e76c-24'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='67e59f9794'>获得多轮对话详情</h2><h3 id='get-api-v1-chatbot-chatbotid-conversation-conversationid'>GET /api/v1/chatbot/:chatbotID/conversation/:conversationId</h3>
<blockquote>
<p>cURL：获得对话详情</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation/<span class="o">{{</span>conversationId<span class="o">}}</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
</code></pre>
<p>获得对话详情</p>
<h4 id='body-25'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-25'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "chatbotID": "{{chatbotID}}",
        "name": "course",
        "modified": "2018-07-11T09:39:58.349Z",
        "created": "2018-07-02T12:02:43.037Z",
        "scriptBody": "+ _resolve_course_\n- 您好，我是小云，您的课程顾问，请问您家小孩多大了？\n\n+ 一年级老师\n- ^get_teachers(1)",
        "enabled": true,
        "id": "{{conversationId}}"
    }
}
</pre>

<p>返回字段说明：</p>
<h4 id='1e8511e76c-25'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='8dc3a12e6a'>启用多轮对话</h2><h3 id='put-api-v1-chatbot-chatbotid-conversation-conversationid-enable'>PUT /api/v1/chatbot/:chatbotID/conversation/:conversationId/enable</h3>
<blockquote>
<p>cURL：使对话处于&quot;启用&quot;状态</p>
</blockquote>
<pre class="highlight shell"><code>curl -X PUT <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation/<span class="o">{{</span>conversationId<span class="o">}}</span>/enable
</code></pre>
<p>使对话处于&quot;启用&quot;状态</p>
<h4 id='body-26'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-26'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "name": "course",
        "chatbotID": "{{chatbotID}}",
        "enabled": true,
        "id": "{{conversationId}}"
    }
}
</pre>

<p>返回字段说明：</p>
<h4 id='1e8511e76c-26'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='5dc9232d11'>禁用多轮对话</h2><h3 id='put-api-v1-chatbot-chatbotid-conversation-conversationid-disable'>PUT /api/v1/chatbot/:chatbotID/conversation/:conversationId/disable</h3>
<blockquote>
<p>cURL：使对话处于&quot;禁用&quot;状态</p>
</blockquote>
<pre class="highlight shell"><code>curl -X PUT <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation/<span class="o">{{</span>conversationId<span class="o">}}</span>/disable <span class="se">\</span>
</code></pre>
<p>使对话处于&quot;禁用&quot;状态</p>
<h4 id='body-27'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-27'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "name": "course",
        "chatbotID": "{{chatbotID}}",
        "enabled": false,
        "id": "{{conversationId}}"
    }
}
</pre>

<p>返回字段说明：</p>
<h4 id='1e8511e76c-27'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='3a19a0893c'>获取环境变量</h2><h3 id='get-api-v1-chatbot-chatbotid-conversation-environment'>GET /api/v1/chatbot/:chatbotID/conversation/environment</h3>
<blockquote>
<p>cURL：获取环境变量</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation/environment <span class="se">\</span>
</code></pre>
<p>获取环境变量</p>

<p>环境变量是多轮对话的在“设计阶段”和“部署阶段”不共享的变量。具体应用场景见<a href="https://mp.weixin.qq.com/s/kTfUGsIOFIupWOgUiVam1Q">多轮对话设计器：快速开始</a>。</p>
<h4 id='body-28'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-28'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "USERNAME": "张三"
    }
}
</pre>

<p>返回字段说明：</p>
<h4 id='1e8511e76c-28'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='513fa606f2'>更新环境变量</h2><h3 id='put-api-v1-chatbot-chatbotid-conversation-environment'>PUT /api/v1/chatbot/:chatbotID/conversation/environment</h3>
<blockquote>
<p>cURL：更新环境变量</p>
</blockquote>
<pre class="highlight shell"><code>curl -X PUT <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation/environment <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
        "USERNAME": "李四",
        "PASSWORD": "123456"
    }'</span>
</code></pre>
<p>更新环境变量</p>
<h4 id='body-29'>BODY</h4>
<pre class="prettyprint">
{
    "USERNAME": "李四",
    "PASSWORD": "123456"
}
</pre>
<h4 id='01b2e1fa11-29'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "msg": "done"
}
</pre>

<p>返回字段说明：</p>
<h4 id='1e8511e76c-29'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='e67bec8043'>检索多轮对话</h2><h3 id='post-api-v1-chatbot-chatbotid-conversation-query'>POST /api/v1/chatbot/:chatbotID/conversation/query</h3>
<blockquote>
<p>cURL：对话问答查询</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation/query <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "fromUserId": "{{uid}}",
    "textMessage": "北京今天天气怎么样",
    "isDebug": false
}'</span>
</code></pre>
<p>对话问答查询</p>
<h4 id='body-30'>BODY</h4>
<pre class="prettyprint">
{
    "fromUserId": "{{uid}}",
    "textMessage": "北京今天天气怎么样",
    "isDebug": false
}
</pre>
<h4 id='01b2e1fa11-30'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "state": "default",
        "createdAt": 1531910247845,
        "string": "白天天气多云，并且空气湿度偏大，在这种天气条件下，您会感到有些闷热，不很舒适。",
        "topicName": "weather",
        "subReplies": [],
        "logic_is_fallback": false,
        "botName": "小叮当",
        "service": {
            "provider": "conversation"
        }
    }
}
</pre>

<p>返回字段说明：</p>

<p><code>state</code>是一些业务需求的约定字段，比如，对话要完成“用户认证”，那么在完成认证后，<code>state</code>会返回<code>auth_succ</code>；认证失败时，返回<code>auth_fail</code>，该字段可通过对话脚本设定。</p>

<p><code>logic_is_fallback</code>代表该回复是否是兜底。</p>

<p><code>topicName</code>代表当前机器人正在聊的话题。</p>

<p><code>botName</code>代表聊天机器人的名字。</p>

<p><code>service</code>代表返回的数据来源，<strong>provider:script</strong>指<strong>多轮对话</strong>，<strong>provider:faq</strong>指<strong>知识库</strong>；不同数据来源也会提供相应信息。</p>

<table><thead>
<tr>
<th>provider</th>
<th>key</th>
<th>解释</th>
</tr>
</thead><tbody>
<tr>
<td>faq</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>docId</td>
<td>文档ID</td>
</tr>
<tr>
<td></td>
<td>post</td>
<td>标准问</td>
</tr>
<tr>
<td></td>
<td>score</td>
<td>分数</td>
</tr>
<tr>
<td></td>
<td>threshold</td>
<td>阀值</td>
</tr>
<tr>
<td>conversation</td>
<td>多轮对话</td>
<td></td>
</tr>
<tr>
<td>fallback</td>
<td>兜底回复</td>
<td></td>
</tr>
<tr>
<td>mute</td>
<td>该用户被该机器人屏蔽</td>
<td></td>
</tr>
</tbody></table>
<h4 id='1e8511e76c-30'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h4 id='6d9de19890'>回复处理逻辑</h4>
<p>多轮对话获取回复的逻辑解释如下：</p>

<table class="image">
<caption align="bottom">查询逻辑</caption>
<tr><td><img width="800" src="images/products/chatbot-engine-1.png" alt="查询逻辑"/></td></tr>
</table>

<ol>
<li>用户输入，以文本的形式输入，语音输入也需要转化成文字。</li>
<li>[知识库检索] 如果知识库检索出相似度大于0.8的问答对，直接返回得分最高的问题的答案。</li>
<li>[多轮对话检索] 如果知识库没有检索出相似度大于0.8的问答对，检索多轮对话，如果命中了一个规则，直接返回答案。</li>
<li>[兜底回复] 如果多轮对话也没有检索出答案，返回兜底回复。</li>
</ol>
<h2 id='abb45a3988'>导入对话应用</h2><h3 id='post-api-v1-chatbot-chatbotid-conversation-droplet-import'>POST /api/v1/chatbot/:chatbotID/conversation/droplet/import</h3>
<blockquote>
<p>cURL：导入对话应用文件</p>
</blockquote>
<pre class="highlight shell"><code><span class="nv">ZIPFILE</span><span class="o">=</span>小叮当-1.0.0-conversations.c66
<span class="nb">set</span> -x
curl -i -X POST -H <span class="s2">"Content-Type: multipart/form-data"</span> <span class="se">\</span>
    -F <span class="s2">"droplet=@</span><span class="nv">$ZIPFILE</span><span class="s2">"</span> <span class="se">\</span>
    -F <span class="s2">"USERNAME=李四"</span> <span class="se">\</span>
    -F <span class="s2">"PASSWORD=123456"</span> <span class="se">\</span>
    http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/conversation/droplet/import
</code></pre>
<p>导入对话应用文件</p>

<p>对话应用文件示例详见<a href="https://github.com/chatopera/conversation-sampleapp">天气查询机器人:多轮对话示例程序</a>。</p>
<h4 id='body-31'>BODY</h4>
<p>multipart表单，环境变量使用<code>-F</code>设定键值对，对话应用文件设置<code>droplet</code>的文件路径，参考cURL样例程序。</p>
<h4 id='01b2e1fa11-31'>成功返回</h4>
<pre class="prettyprint">
{
  "rc": 0,
  "data": {
    "msg": "Import is done successfully."
  }
}
</pre>
<h4 id='1e8511e76c-31'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='f1e15ab5ce'>获取用户列表</h2><h3 id='get-api-v1-chatbot-chatbotid-users'>GET /api/v1/chatbot/:chatbotID/users</h3>
<blockquote>
<p>cURL：获取用户列表</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/api/v1/chatbot/<span class="o">{{</span>chatbotID<span class="o">}}</span>/users <span class="se">\</span>
  -H <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>获取用户列表</p>

<p>在智能问答引擎中，并不具备管理用户的功能，但是在每次请求<strong>/api/v1/chatbot/{{chatbotID}}/conversation/query</strong>或<strong>/api/v1/chatbot/{{chatbotID}}/faq/query</strong>时，在body中传入的<strong>fromUserId</strong>会被保存为一个用户。</p>

<p>在智能问答引擎中，将<strong>chatbotID</strong>下的每个<strong>fromUserId</strong>视为该聊天机器人的用户唯一标识，所以<strong>chatbotID</strong>和<strong>fromUserId</strong>具有联合唯一的性质。</p>
<h4 id='query-3'>QUERY</h4>
<p>在url中，支持使用检索条件，比如 <code>/api/v1/chatbot/{{chatbotID}}/users?page=1&amp;limit=10</code>，各参数介绍如下：</p>

<table><thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>默认值</th>
<th>示例</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>number</td>
<td>返回本页数据的条数</td>
<td>100</td>
<td>10</td>
</tr>
<tr>
<td>page</td>
<td>number</td>
<td>返回哪一页(可根据total进行判断)</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>sortby</td>
<td>string</td>
<td>返回值的排序条件</td>
<td>-lasttime (按照最后一次对话时间降序)</td>
<td>-created (按照初次对话时间降序), lasttime (按照最后一次对话升序)</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-32'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "total": 1,
    "current_page": 1,
    "total_page": 1,
    "data": [
        {
            "chatbotID": "{{chatbotID}}",
            "userId": "postman",
            "lasttime": "2018-10-06T01:22:30.584Z",
            "created": "2018-10-06T01:19:30.726Z"
        }
    ]
}
</pre>

<p>返回字段说明：</p>

<p><code>total</code>代表用户总数量。</p>

<p><code>current_page</code>代表当前页，<code>total_page</code>代表总页数。</p>

<p><code>data</code>是用户数据，<code>userId</code>是用户ID，<code>lasttime</code>是该用户最后一次对话时间，<code>create</code>是该用户第一次对话时间。</p>
<h4 id='1e8511e76c-32'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='dd6b194d03'>屏蔽指定用户</h2><h3 id='post-api-v1-chatbot-chatbotid-users-userid-mute'>POST /api/v1/chatbot/:chatbotID/users/:userId/mute</h3>
<blockquote>
<p>cURL：屏蔽指定用户</p>
</blockquote>
<pre class="highlight plaintext"><code>curl -X POST \
  http://{{IP}}:8003/api/v1/chatbot/{{chatbotID}}/users/{{userId}}/mute \
  -H 'Content-Type: application/json'
</code></pre>
<p>屏蔽用户</p>

<p>根据<strong>chatbotID</strong>和<strong>userId</strong>屏蔽该用户，该用户被屏蔽后，该用户作为<em>fromUserId</em>时，发起对轮对话查询时，返回结果如下：</p>

<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "state": "default",
        "string": null,
        "botName": "BOTNAME",
        "logic_is_unexpected": false,
        "service": {
            "provider": "mute"
        }
    }
}
</pre>

<p>【提示】返回<em>service.provider=&#39;mute&#39;</em>的结果。</p>

<p>发起知识库问答时，返回如下结果：</p>

<pre class="prettyprint">
{
    "rc": 10,
    "error": "userId [xxx] is blocked with chatbotID [xxx]"
}
</pre>

<p>【提示】返回结果<em>rc=10</em> 。</p>
<h4 id='01b2e1fa11-33'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {}
}
</pre>
<h4 id='1e8511e76c-33'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='bb401c2d05'>检查用户是否被屏蔽</h2><h3 id='post-api-v1-chatbot-chatbotid-users-userid-ismute'>POST /api/v1/chatbot/:chatbotID/users/:userId/ismute</h3>
<blockquote>
<p>cURL：检查用户是否被屏蔽</p>
</blockquote>
<pre class="highlight plaintext"><code>curl -X POST \
  http://{{IP}}:8003/api/v1/chatbot/{{chatbotID}}/users/{{userId}}/ismute \
  -H 'Content-Type: application/json'
</code></pre>
<p>检查用户是否被屏蔽</p>

<p>根据<strong>chatbotID</strong>和<strong>userId</strong>检查该用户是否被屏蔽。</p>
<h4 id='01b2e1fa11-34'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {
        "mute": true
    }
}
</pre>
<h4 id='1e8511e76c-34'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='26ca07432b'>取消屏蔽用户</h2><h3 id='post-api-v1-chatbot-chatbotid-users-userid-unmute'>POST /api/v1/chatbot/:chatbotID/users/:userId/unmute</h3>
<blockquote>
<p>cURL：取消屏蔽用户</p>
</blockquote>
<pre class="highlight plaintext"><code>curl -X POST \
  http://{{IP}}:8003/api/v1/chatbot/{{chatbotID}}/users/{{userId}}/unmute \
  -H 'Content-Type: application/json'
</code></pre>
<p>根据chatbotID和userId取消对一个用户的屏蔽。</p>
<h4 id='01b2e1fa11-35'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "data": {}
}
</pre>
<h4 id='1e8511e76c-35'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='6746784c6a'>获取用户聊天历史</h2><h3 id='get-api-v1-chatbot-chatbotid-users-userid-chats'>GET /api/v1/chatbot/:chatbotID/users/:userId/chats</h3>
<blockquote>
<p>cURL：获取用户聊天历史</p>
</blockquote>
<pre class="highlight plaintext"><code>curl -X GET \
  'http://{{IP}}:8003/api/v1/chatbot/{{chatbotID}}/users/{{userId}}/chats?limit=20' \
  -H 'Accept: application/json' \
  -H 'Content-Type: application/json' \
</code></pre>
<p>获取用户聊天历史</p>

<p>根据<strong>chatbotID</strong>和<strong>userId</strong>获取聊天历史记录</p>
<h4 id='query-4'>QUERY</h4>
<p>在url中，支持使用检索条件，比如 <code>/api/v1/chatbot/{{chatbotID}}/users/{{userID}}/chats?page=1&amp;limit=10</code>，各参数介绍如下：</p>

<table><thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>默认值</th>
<th>示例</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>number</td>
<td>返回本页数据的条数</td>
<td>100</td>
<td>10</td>
</tr>
<tr>
<td>page</td>
<td>number</td>
<td>返回哪一页(可根据total进行判断)</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>sortby</td>
<td>string</td>
<td>返回值的排序条件</td>
<td>-created (按照对话时间降序)</td>
<td>created (按照初次对话时间升序)</td>
</tr>
</tbody></table>
<h4 id='01b2e1fa11-36'>成功返回</h4>
<pre class="prettyprint">
{
    "rc": 0,
    "total": 2,
    "current_page": 1,
    "total_page": 1,
    "data": [
        {
            "chatbotID": "gmis_department_11",
            "userId": "postman",
            "textMessage": "白天不太热也不太冷，风力不大，相信您在这样的天气条件下，应会感到比较清爽和舒适。",
            "direction": "outbound",
            "service": "conversation",
            "created": "2018-10-06T01:58:27.828Z"
        },
        {
            "chatbotID": "gmis_department_11",
            "userId": "postman",
            "textMessage": "北京今天天气怎么样",
            "direction": "inbound",
            "created": "2018-10-06T01:58:22.270Z"
        }
    ]
}
</pre>

<p>返回字段说明：</p>

<p><code>direction</code>代表数据传递方向，<code>inbound</code>是用户发送给聊天机器人，<code>outbound</code>是聊天机器人发送给用户。
<code>textMessage</code>发送的文字消息。
<code>service</code>在发送为<code>outbound</code>时，机器人获取答案的服务标识: <code>conversation</code> 代表多轮对话； <code>faq</code>代表知识库；<code>fallback</code>代表兜底回复。</p>
<h4 id='1e8511e76c-36'>异常返回</h4>
<pre class="prettyprint">
{
    "rc": 1,
    "error": ... 
}
</pre>

<p>返回字段说明：</p>

<p><code>rc</code>为正整数时，代表异常，异常描述为<code>error</code>。</p>
<h2 id='def9e81899'>获取应用健康状态</h2><h3 id='get-ping'>GET /ping</h3>
<blockquote>
<p>cURL：获取应用健康状态</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
  http://<span class="o">{{</span>IP<span class="o">}}</span>:8003/ping <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<p>获取应用健康状态</p>
<h4 id='body-32'>BODY</h4>
<p><code>null</code></p>
<h4 id='01b2e1fa11-37'>成功返回</h4>
<pre class="prettyprint">
{
    "timestamp": 1531918165514,
    "uptime": 8783.43,
    "application": {
        "name": "superbrain",
        "version": "1.0.0",
        "pid": 1,
        "title": "node",
        "argv": [
            "/usr/local/bin/node",
            "/app/app.js"
        ],
        "versions": {
            "http_parser": "2.8.0",
            "node": "8.11.3",
            "v8": "6.2.414.54",
            "uv": "1.19.1",
            "zlib": "1.2.11",
            "ares": "1.10.1-DEV",
            "modules": "57",
            "nghttp2": "1.32.0",
            "napi": "3",
            "openssl": "1.0.2o",
            "icu": "60.1",
            "unicode": "10.0",
            "cldr": "32.0",
            "tz": "2017c"
        }
    },
    "resources": {
        "memory": {
            "rss": 369848320,
            "heapTotal": 130859008,
            "heapUsed": 108874240,
            "external": 18007788
        },
        "loadavg": [
            0.35302734375,
            0.28759765625,
            0.2412109375
        ],
        "cpu": [
            {
                "model": "Intel(R) Xeon(R) CPU E5-2682 v4 @ 2.50GHz",
                "speed": 2500,
                "times": {
                    "user": 1586270600,
                    "nice": 0,
                    "sys": 1050236500,
                    "idle": 21709890800,
                    "irq": 0
                }
            },
            {
                "model": "Intel(R) Xeon(R) CPU E5-2682 v4 @ 2.50GHz",
                "speed": 2500,
                "times": {
                    "user": 1562807900,
                    "nice": 0,
                    "sys": 1015181800,
                    "idle": 21782348900,
                    "irq": 0
                }
            }
        ],
        "disk": [
            {
                "filesystem": "overlay",
                "size": 123721700,
                "used": 94808660,
                "available": 22605316,
                "capacity": 0.81,
                "mount": "/"
            },
            {
                "filesystem": "tmpfs",
                "size": 65536,
                "used": 0,
                "available": 65536,
                "capacity": 0,
                "mount": "/dev"
            },
            {
                "filesystem": "tmpfs",
                "size": 8216392,
                "used": 0,
                "available": 8216392,
                "capacity": 0,
                "mount": "/sys/fs/cgroup"
            },
            {
                "filesystem": "/dev/vda1",
                "size": 123721700,
                "used": 94808660,
                "available": 22605316,
                "capacity": 0.81,
                "mount": "/app/logs"
            },
            {
                "filesystem": "shm",
                "size": 65536,
                "used": 0,
                "available": 65536,
                "capacity": 0,
                "mount": "/dev/shm"
            },
            {
                "filesystem": "tmpfs",
                "size": 8216392,
                "used": 0,
                "available": 8216392,
                "capacity": 0,
                "mount": "/sys/firmware"
            }
        ],
        "nics": {
            "lo": [
                {
                    "address": "127.0.0.1",
                    "netmask": "255.0.0.0",
                    "family": "IPv4",
                    "mac": "00:00:00:00:00:00",
                    "internal": true,
                    "cidr": "127.0.0.1/8"
                }
            ],
            "eth0": [
                {
                    "address": "172.19.0.15",
                    "netmask": "255.255.0.0",
                    "family": "IPv4",
                    "mac": "02:42:ac:13:00:0f",
                    "internal": false,
                    "cidr": "172.19.0.15/16"
                }
            ]
        }
    },
    "system": {
        "arch": "x64",
        "platform": "linux",
        "type": "Linux",
        "release": "4.4.0-62-generic",
        "hostname": "29866b45ce71",
        "uptime": 2453892,
        "cores": 2,
        "memory": 16827174912
    }
}
</pre>

<p>返回字段说明：</p>

<p>描述应用和操作系统的各种数据。</p>

<script defer="true" src="https://im.chatopera.com/im/0awgro.html"></script>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
